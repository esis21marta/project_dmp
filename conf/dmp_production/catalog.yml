_jdbc_oracle_qa_db: &jdbc_oracle_qa_db
  type: spark.SparkJDBCDataSet
  url: jdbc:oracle:thin:@10.53.71.164:1521:OPTOIPIMC2
  credentials: qa_credentials_user_pass
  load_args:
    properties:
      driver: "oracle.jdbc.driver.OracleDriver"
  save_args:
    mode: "append"
    properties:
      driver: "oracle.jdbc.driver.OracleDriver"

_hive: &hive
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  write_mode: overwrite

_parquet: &parquet
  type: src.dmp.io.spark_data_set.SparkDataSet
  file_format: parquet
  save_args:
    mode: overwrite

_hive_trx_date_1w: &hive_trx_date_1w
  <<: *hive
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  load_args:
    partition_filter_period: 1w
    partition_column: trx_date
    partition_date_format: "%Y%m%d"

_parquet_trx_date_1w: &parquet_trx_date_1w
  <<: *parquet
  save_args:
    mode: overwrite
    partitionBy: trx_date
  load_args:
    partition_filter_period: 1w
    partition_column: trx_date
    partition_date_format: "%Y%m%d"

_parquet_trx_date_3m: &parquet_trx_date_3m
  <<: *parquet_trx_date_1w
  load_args:
    partition_filter_period: 3m
    partition_column: trx_date
    partition_date_format: "%Y%m%d"

_hive_event_date_1w: &hive_event_date_1w
  <<: *hive
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  load_args:
    partition_filter_period: 1w
    partition_column: event_date
    partition_date_format: "%Y-%m-%d"

_hive_trx_date_1cm: &hive_trx_date_1cm
  <<: *hive_event_date_1w
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  load_args:
    partition_filter_period: 1cm
    partition_column: trx_date
    partition_date_format: "%Y%m%d"

_parquet_trx_date_1w_format_2: &parquet_trx_date_1w_format_2
  <<: *parquet
  save_args:
    mode: overwrite
    partitionBy: trx_date
  load_args:
    partition_filter_period: 1w
    partition_column: trx_date
    partition_date_format: "%Y-%m-%d"

_parquet_trx_date_1cm: &parquet_trx_date_1cm
  <<: *parquet_trx_date_1w
  load_args:
    partition_filter_period: 1cm
    partition_column: trx_date
    partition_date_format: "%Y%m%d"

_parquet_trx_date_1cm_format_2: &parquet_trx_date_1cm_format_2
  <<: *parquet_trx_date_1w_format_2
  load_args:
    partition_filter_period: 1cm
    partition_column: trx_date
    partition_date_format: "%Y-%m-%d"

_hive_event_date_1cm: &hive_event_date_1cm
  <<: *hive_event_date_1w
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  load_args:
    partition_filter_period: 1cm
    partition_column: event_date
    partition_date_format: "%Y-%m-%d"

_hive_month_3cm: &hive_month_3cm
  <<: *hive
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  load_args:
    partition_filter_period: 3cm
    partition_column: month
    partition_date_format: "%Y%m"

_parquet_weekstart_1w: &parquet_weekstart_1w
  <<: *parquet
  save_args:
    mode: overwrite
    partitionBy: weekstart
  load_args:
    partition_filter_period: 1w
    partition_column: weekstart
    partition_date_format: "%Y-%m-%d"

_parquet_weekstart_3m: &parquet_weekstart_3m
  <<: *parquet_weekstart_1w
  load_args: &parquet_weekstart_3m_load_args
    partition_filter_period: 3m
    partition_column: weekstart
    partition_date_format: "%Y-%m-%d"

_parquet_weekstart_6m: &parquet_weekstart_6m
  <<: *parquet_weekstart_1w
  load_args:
    partition_filter_period: 6m
    partition_column: weekstart
    partition_date_format: "%Y-%m-%d"

_parquet_event_date_1w: &parquet_event_date_1w
  <<: *parquet
  save_args:
    mode: overwrite
    partitionBy: event_date
  load_args:
    partition_filter_period: 1w
    partition_column: event_date
    partition_date_format: "%Y-%m-%d"

_parquet_event_date_1cm: &parquet_event_date_1cm
  <<: *parquet_event_date_1w
  load_args:
    partition_filter_period: 1cm
    partition_column: event_date
    partition_date_format: "%Y-%m-%d"

_parquet_mo_id_6cm: &parquet_mo_id_6cm
  <<: *parquet
  save_args:
    mode: overwrite
    partitionBy: mo_id
  load_args:
    partition_filter_period: 6cm
    partition_column: mo_id
    partition_date_format: "%Y-%m"

_parquet_mo_id_3cm: &parquet_mo_id_3cm
  <<: *parquet
  save_args:
    mode: overwrite
    partitionBy: mo_id
  load_args:
    partition_filter_period: 3cm
    partition_column: mo_id
    partition_date_format: "%Y-%m"

_hive_month_6cm: &hive_month_6cm
  <<: *hive
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  load_args:
    partition_filter_period: 6cm
    partition_column: month
    partition_date_format: "%Y%m"

_hive_mo_id_6cm: &hive_mo_id_6cm
  <<: *hive
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  load_args:
    partition_filter_period: 6cm
    partition_column: mo_id
    partition_date_format: "%Y-%m"

_hive_yearweek_1w: &hive_yearweek_1w
  <<: *hive
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  load_args:
    partition_filter_period: 1w
    partition_column: yearweek_partition
    partition_date_format: "%Y%W"

########################################################################################################################
#######################################################  Common ########################################################
########################################################################################################################

# Weekly Scaffold - 3 Months
l1_weekly_scaffold:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/scaffold_weekly.parquet
  partitions: 50

# Weekly Scaffold - 4 Months
l1_weekly_scaffold_4m:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/scaffold_weekly_4m.parquet
  partitions: 50
  load_args:
    partition_filter_period: 4m
    partition_column: weekstart
    partition_date_format: "%Y-%m-%d"

# Weekly Scaffold - 5 Months
l1_weekly_scaffold_5m:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/scaffold_weekly_5m.parquet
  partitions: 50
  load_args:
    partition_filter_period: 5m
    partition_column: weekstart
    partition_date_format: "%Y-%m-%d"

# Weekly Scaffold - 6 Months
l1_weekly_scaffold_6m:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/scaffold_weekly_6m.parquet
  partitions: 50


l1_monthly_scaffold:
  <<: *parquet_mo_id_6cm
  layer: primary
  filepath: mck_dmp_score/02_primary/monthly_scaffold.parquet
  partitions: 20

# List of MSISDNs for pipeline
partner_msisdns:
  <<: *parquet
  layer: primary
  filepath: mck_dmp_score/02_primary/partner_msisdns.parquet
  partitions: 10

partner_msisdns_old:
  <<: *parquet
  layer: primary
  filepath: mck_dmp_score/02_primary/partner_msisdns.parquet
  partitions: 10

l1_prepaid_customers_data_5m:
  <<: *hive_event_date_1w
  layer: raw
  database: cb
  table: cb_pre_dd
  load_args:
    partition_filter_period: 5m
    partition_column: event_date
    partition_date_format: "%Y-%m-%d"

l1_prepaid_customers_data_6m:
  <<: *hive_event_date_1w
  layer: raw
  database: cb
  table: cb_pre_dd
  load_args:
    partition_filter_period: 6m
    partition_column: event_date
    partition_date_format: "%Y-%m-%d"

l1_postpaid_customers_data_5m:
  <<: *hive_event_date_1w
  layer: raw
  database: cb
  table: cb_post_dd
  load_args:
    partition_filter_period: 5m
    partition_column: event_date
    partition_date_format: "%Y-%m-%d"

l1_postpaid_customers_data_6m:
  <<: *hive_event_date_1w
  layer: raw
  database: cb
  table: cb_post_dd
  load_args:
    partition_filter_period: 6m
    partition_column: event_date
    partition_date_format: "%Y-%m-%d"

########################################################################################################################
##################################################  Customer LOS #######################################################
########################################################################################################################

##################################
#######  Source TSEL Data  #######
##################################
l1_t_profile_full_hist:
  <<: *hive
  layer: raw
  database: mck
  table: t_profile_full_hist

l1_postpaid_customers_data:
  <<: *hive_event_date_1w
  layer: raw
  database: cb
  table: cb_post_dd
  sla_interval:
    start_date: "2019-01-01"

###################################
#######  AGGREGATION LAYER  #######
###################################

l1_customer_los_weekly:
  <<: *parquet_weekstart_1w
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/customer_los/customer_los_weekly.parquet
  partitions: 20

###################################
#########  PRIMARY LAYER  #########
###################################

l2_customer_los_weekly_data_final:
  <<: *parquet_weekstart_1w
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_los/customer_los_weekly_final.parquet
  partitions: 25

###################################
#########  FEATURE LAYER  #########
###################################

l3_customer_los_msisdn_weekstart:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/customer_los/customer_los_msisdn_weekstart.parquet
  partitions: 25

l4_fea_customer_los:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/customer_los/fea_customer_los.parquet
  partitions: 25

########################################################################################################################
############################################  Internet Apps Usage Features  ############################################
########################################################################################################################

##################################
#########  STATIC LAYER  #########
##################################

# Mappings for BCP Data to Apps Categories
l1_content_mapping:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_apps_usage/content_mapping.parquet
  partitions: 1

l1_segment_mapping:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_apps_usage/segment_mapping.parquet
  partitions: 1

l1_category_mapping:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_apps_usage/category_mapping.parquet
  partitions: 1

l1_fintech_mapping:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_apps_usage/fintech_mapping.parquet
  partitions: 1

l1_app_mapping:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_apps_usage/app_mapping.parquet
  partitions: 1

# Final Mapping of BCP Data to Features
l1_internet_app_feature_mapping:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_apps_usage/internet_app_feature_category_mapping.parquet
  partitions: 1

##################################
#######  Source TSEL Data  #######
##################################

## Original BCP Data
l1_bcp_usage_daily:
  <<: *hive_trx_date_1w
  layer: raw
  database: mig
  table: smy_bcp_usage_dd
  sla_interval:
    start_date: "2019-01-01"

l1_internet_app_competitor_monthly:
  <<: *hive_month_3cm
  layer: raw
  database: rna
  table: bcpusg_appscat_apps_comp
  load_args:
    partition_filter_period: 3cm
    partition_column: month
    partition_date_format: "%Y%m"
  sla_interval:
    period: 2d
    date: 1
    time: "10:00"
    start_date: "2019-01-01"

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Data for the Internet Usage for apps
l2_internet_app_usage_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_apps_usage/app_usage_weekly.parquet
  partitions: 600

# Weekly Aggregated Data for the Internet Usage from bcp
l2_internet_connection_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_apps_usage/internet_usage_weekly.parquet
  partitions: 100

l2_internet_app_usage_competitor_monthly:
  <<: *parquet_mo_id_3cm
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_apps_usage/app_usage_competitor_monthly.parquet
  partitions: 20

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs Internet Usage Data for apps
l3_internet_app_usage_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/internet_apps_usage/app_usage_weekly_partner.parquet
  partitions: 2000

# Weekly Aggregated Internet Usage for Apps Data and filled missing weeks
l4_internet_app_usage_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/internet_apps_usage/app_usage_weekly_final.parquet
  partitions: 2000

# Partner MSISDNs Internet Usage Data from BCP
l3_internet_connection_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/internet_apps_usage/internet_app_usage_weekly_partner.parquet
  partitions: 200

# Weekly Aggregated Internet Usage Data from BCP and filled missing weeks
l4_internet_connection_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/internet_apps_usage/internet_app_usage_weekly_final.parquet
  partitions: 200

# Partner MSISDNs Internet app usage monthly competitor
l3_internet_app_usage_competitor_monthly_filtered:
  <<: *parquet_mo_id_3cm
  layer: primary
  filepath: mck_dmp_score/02_primary/internet_apps_usage/app_usage_competitor_monthly_partner.parquet
  partitions: 2

# Monthly Aggregated Internet App Usage Competitor Data and filled missing months
l4_internet_app_usage_competitor_monthly_final:
  <<: *parquet_mo_id_3cm
  layer: primary
  filepath: mck_dmp_score/02_primary/internet_apps_usage/app_usage_competitor_monthly_final.parquet
  partitions: 2

###################################
#########  FEATURE LAYER  #########
###################################

# Internet Connection Features
l5_fea_internet_connection:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/internet_apps_usage/fea_internet_connection.parquet
  partitions: 500

# Internet App Usage Features
l5_internet_app_usage:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/internet_apps_usage/internet_app_usage.parquet
  partitions: 1000

# Internet App Usage Features Pivoted
l5_pivoted_internet_app_usage:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/internet_apps_usage/pivoted_internet_app_usage.parquet
  partitions: 1000

# Internet App Usage Features Final Files
l5_fea_internet_app_usage:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/internet_apps_usage/fea_internet_app_usage.parquet
  partitions: 1000

l5_fea_social_media:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/internet_apps_usage/fea_social_media.parquet
  partitions: 150

# Internet app usage monthly competitor features
l5_fea_internet_app_usage_competitor:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/internet_apps_usage/internet_app_usage_competitor.parquet
  partitions: 20

########################################################################################################################
##############################################  Internet Usage Features  ###############################################
########################################################################################################################

##################################
#######  Source TSEL Data  #######
##################################

# Original Internet Usage Data
# After august 2019, abt table used
# Before august 2019, smy.usage_upcc_dd
l1_usage_upcc_dd:
  <<: *hive_event_date_1w
  layer: raw
  database: abt
  table: usage_upcc_abt_dd
  sla_interval:
    start_date: "2019-01-01"

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Internet Usage Data
l1_internet_usage_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/internet_usage/internet_usage_weekly.parquet
  partitions: 100

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs Internet Usage Data
l1_internet_usage_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/internet_usage/internet_usage_weekly_partner_data.parquet
  partitions: 125

# Weekly Aggregated Internet Usage Data and filled missing weeks
l1_internet_usage_scaffold_weekly:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/internet_usage/internet_usage_weekly_time_series_filled.parquet
  partitions: 125

###################################
#########  FEATURE LAYER  #########
###################################

# Internet Usage Features Intermediate Files
l2_internet_usage_prep:
  <<: *parquet_weekstart_3m
  layer: feature
  filepath: mck_dmp_score/04_features/internet_usage/fea_internet_usage_consumption_prep.parquet
  partitions: 300

# Internet Usage Features
l2_internet_usage:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/internet_usage/fea_internet_usage_consumption.parquet
  partitions: 600

########################################################################################################################
##################################################  Handset Features  ##################################################
########################################################################################################################

##################################
#######  Source TSEL Data  #######
##################################

# Original Handset Data
l1_handset_dim_lookup:
  <<: *hive
  layer: raw
  database: dim
  table: device_dim
  sla_interval:
    period: 1d
    date: 1
    time: "07:00"
    column_reference: "event_date"
    date_format: "%Y-%m-%d"
    start_date: "2019-01-01"

l1_handset_dd:
  <<: *hive
  layer: raw
  database: smy
  table: device_dd
  sla_interval:
    period: 1d
    date: 1
    time: "07:00"
    column_reference: "event_date"
    date_format: "%Y-%m-%d"
    start_date: "2019-01-01"

l1_handset_mm:
  <<: *hive
  layer: raw
  database: smy
  table: device_mm
  sla_interval:
    period: 1d
    date: 1
    time: "07:00"
    column_reference: "event_date"
    date_format: "%Y-%m-%d"

l1_imei_user_count:
  <<: *hive_month_6cm
  layer: feature
  database: dbi_bb
  table: imei_user_count
  load_args:
    partition_filter_period: 6cm
    partition_column: month
    partition_date_format: "%Y%m"

###################################
#######  AGGREGATION LAYER  #######
###################################

# Filtered Data per IMEI
l1_handset_lookup_data:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/handset/hanset_lookup_data.parquet
  partitions: 1

# Weekly Aggregated Handset Data
l2_handset_weekly_aggregated:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/handset/device_data_weekly.parquet
  partitions: 50
  load_args:
    partition_filter_period: 5m
    partition_column: weekstart
    partition_date_format: "%Y-%m-%d"

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs Handset Data
l2_handset_weekly_aggregated_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/handset/handset_data_weekly_partner.parquet
  partitions: 50
  load_args:
    partition_filter_period: 5m
    partition_column: weekstart
    partition_date_format: "%Y-%m-%d"

# Weekly Aggregated Handset Data and filled missing weeks
l2_handset_time_series_filled:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/handset/handset_time_series_filled.parquet
  partitions: 50
  load_args:
    partition_filter_period: 5m
    partition_column: weekstart
    partition_date_format: "%Y-%m-%d"

###################################
#########  FEATURE LAYER  #########
###################################

# Handset Features
l2_fea_handset:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/handset/fea_handset.parquet
  partitions: 50

# Handset imei Features
l4_fea_handset_imei:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/handset/fea_device_imei.parquet
  partitions: 5

########################################################################################################################
##################################################  Recharge Features  #################################################
########################################################################################################################

##################################
#######  Source TSEL Data  #######
##################################

# Recharge Data
l1_abt_rech_daily_abt_dd:
  <<: *hive_event_date_1w
  layer: raw
  database: abt
  table: rech_daily_abt_dd
  sla_interval:
    start_date: "2019-01-01"

# Account Balance Data
l1_account_balance:
  <<: *hive_event_date_1w
  layer: raw
  database: base
  table: ocs_bal
  sla_interval:
    start_date: "2019-01-01"

# Prepaid Customer Data
l1_prepaid_customers_data:
  <<: *hive_event_date_1w
  layer: raw
  database: cb
  table: cb_pre_dd
  sla_interval:
    start_date: "2019-01-01"

l1_smy_rech_urp_dd:
  <<: *hive
  layer: raw
  database: smy
  table: rech_urp_dd
  sla_interval:
    period: 1d
    date: 1
    time: "02:30"
    column_reference: "event_date"
    date_format: "%Y-%m-%d"

## MyTsel
l1_mytsel_rech_dd:
  <<: *hive
  layer: raw
  database: mck
  table: dd_mytsel_rech
  load_args:
    partition_filter_period: 1w
    partition_column: trx_date
    partition_date_format: "%Y-%m-%d"
  sla_interval:
    period: 1d
    date: 2
    time: "09:00"
    start_date: "2020-01-01"

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Recharge Data
l1_rech_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/recharge/rech_weekly.parquet
  partitions: 10

l2_account_balance_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/recharge/acc_bal_weekly_v3.parquet
  partitions: 25

l1_chg_pkg_prchse_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/recharge/chg_pkg_prchse_weekly.parquet
  partitions: 10

l1_digi_rech_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/recharge/digi_rech_weekly.parquet
  partitions: 2

## MyTsel
l1_mytsel_rech_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/recharge/mytsel_rech_weekly.parquet
  partitions: 1

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs Recharge Data
l1_rech_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/rech_weekly_partner.parquet
  partitions: 10

l1_acc_bal_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/acc_bal_weekly_partner.parquet
  partitions: 25

l1_chg_pkg_prchse_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/chg_pkg_prchse_weekly_partner.parquet
  partitions: 10

# Weekly Aggregated Recharge Data and filled missing weeks
l1_rech_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/rech_weekly_final.parquet
  partitions: 20

l1_acc_bal_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/acc_bal_weekly_final.parquet
  partitions: 20

l1_chg_pkg_prchse_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/chg_pkg_prchse_weekly_final.parquet
  partitions: 25

l1_digi_rech_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/digi_rech_weekly_partner.parquet
  partitions: 5

l1_digi_rech_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/digi_rech_weekly_final.parquet
  partitions: 20

## MyTsel
l1_mytsel_rech_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/mytsel_rech_weekly_partner.parquet
  partitions: 10 # TODO: Update Partition

## MyTsel
l1_mytsel_rech_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/recharge/mytsel_rech_weekly_final.parquet
  partitions: 10 # TODO: Update Partition



###################################
#########  FEATURE LAYER  #########
###################################

# Recharge Features
l5_fea_recharge:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/recharge/fea_recharge.parquet
  partitions: 150

l5_fea_recharge_mytsel:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/recharge/fea_recharge_mytsel.parquet
  partitions: 10 # TODO: Update Partition

########################################################################################################################
##################################################  Revenue Features  ##################################################
########################################################################################################################

##################################
#########  STATIC LAYER  #########
##################################

# Repayment Loan IDs
l1_airtime_loan_id:
  <<: *parquet
  layer: static
  filepath: mck_dmp_pipeline/00_reference/airtime/airtime_loan_content_ids.parquet
  partitions: 1

##################################
#######  Source TSEL Data  #######
##################################

l1_merge_revenue_dd:
  <<: *hive_event_date_1w
  layer: raw
  database: mck
  table: merge_revenue_dd

# Original Revenue Data
l1_itdaml_dd_cdr_pkg_prchse_all:
  <<: *hive_event_date_1w
  layer: raw
  database: abt
  table: usage_chg_pkg_prchse_abt_dd
  sla_interval:
    period: 1d
    date: 1
    time: "03:00"
    start_date: "2019-01-01"

l1_itdaml_dd_cdr_payu_prchse_all:
  <<: *hive_event_date_1w
  layer: raw
  database: abt
  table: usage_chg_payu_abt_dd
  sla_interval:
    period: 1d
    date: 1
    time: "05:00"
    start_date: "2019-01-01"

l1_usage_rcg_prchse_abt_dd:
  <<: *hive_event_date_1w
  layer: raw
  database: abt
  table: usage_rcg_prchse_abt_dd
  sla_interval:
    period: 1d
    date: 1
    time: "05:00"
    start_date: "2019-05-31"

l1_mck_mytsel_pack:
  <<: *hive
  layer: raw
  database: mck
  table: dd_mytsel_pack
  load_args:
    partition_filter_period: 1w
    partition_column: trx_date
    partition_date_format: "%Y-%m-%d"
  sla_interval:
    period: 1d
    date: 2
    time: "09:00"
    start_date: "2020-01-01"

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Revenue Data
l2_revenue_weekly_data:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/revenue/revenue_weekly_v2.parquet
  partitions: 50

l2_revenue_alt_weekly_data:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/revenue/revenue_alt_weekly_v2.parquet
  partitions: 50

# Weekly MyTSel Revenue Aggregate
l2_revenue_mytsel_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/revenue/revenue_mytsel_weekly.parquet
  partitions: 1

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs Revenue Data
l3_revenue_weekly_data_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/revenue/revenue_weekly_partner.parquet
  partitions: 50

l3_revenue_alt_weekly_data_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/revenue/revenue_alt_weekly_partner.parquet
  partitions: 50

# Weekly Aggregated Revenue Data and filled missing weeks
l4_revenue_weekly_data_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/revenue/revenue_weekly_final.parquet
  partitions: 50

l4_revenue_alt_weekly_data_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/revenue/revenue_alt_weekly_final.parquet
  partitions: 50

# MyTSel
l3_revenue_mytsel_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/revenue/revenue_mytsel_weekly_filtered.parquet
  partitions: 10 # TODO: To be updated

l3_revenue_mytsel_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/revenue/revenue_mytsel_weekly_final.parquet
  partitions: 10 # TODO: To be updated

###################################
#########  FEATURE LAYER  #########
###################################

# Revenue Features
l4_fea_revenue_weekend:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/revenue/fea_revenue_weekend.parquet
  partitions: 100

l4_fea_revenue_base_payu_pkg:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/revenue/fea_revenue_base_payu_pkg.parquet
  partitions: 100

l4_fea_revenue_spend_pattern:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/revenue/fea_revenue_spend_pattern.parquet
  partitions: 100

l4_fea_revenue_monthly_spend:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/revenue/fea_revenue_monthly_spend.parquet
  partitions: 100

l4_fea_revenue_salary:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/revenue/fea_revenue_salary.parquet
  partitions: 100

l4_fea_revenue_threshold_voice_data:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/revenue/fea_revenue_threshold_voice_data.parquet
  partitions: 100

l4_fea_revenue_threshold_sms_dls_roam:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/revenue/fea_revenue_threshold_sms_dls_roam.parquet
  partitions: 100

# Weekly MyTSel Revenue Features
l4_fea_revenue_mytsel:
  <<: *parquet_weekstart_3m
  layer: feature
  filepath: mck_dmp_score/04_features/revenue/fea_revenue_mytsel.parquet
  partitions: 10 # TODO: To be updated

########################################################################################################################
################################################  Text Messaging Features ##############################################
########################################################################################################################

##################################
#########  STATIC LAYER  #########
##################################

# SMS A2P Mapping
l1_commercial_text_mapping:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/sms/sms_sender_mapping.parquet
  partitions: 5

# Broken Bnumber mapping
l1_broken_bnumber:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/sms/broken_bnumber.parquet
  partitions: 1

##################################
#######  Source TSEL Data  #######
##################################

# Original ABT Usage MSS Data
l1_abt_usage_mss_abt_dd:
  <<: *hive_event_date_1w
  layer: raw
  database: abt
  table: usage_mss_abt_dd
  sla_interval:
    start_date: "2019-01-01"

###################################
#######  AGGREGATION LAYER  #######
###################################

# Text Messaging Weekly Aggregation
l2_text_messaging_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/sms/text_messaging_weekly.parquet
  partitions: 50

# Commercial Text Messaging Weekly Aggregation
l2_commercial_text_messaging_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/sms/commercial_text_messaging_weekly.parquet
  partitions: 50

l2_kredivo_sms_recipients:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/sms/kredivo_sms_recipients.parquet
  partitions: 1

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs Text Messaging Data
l2_text_messaging_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/sms/text_messaging_weekly_partner.parquet
  partitions: 150

# Partner MSISDNs Commercial Text Messaging Data
l2_commercial_text_messaging_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/sms/commercial_text_messaging_weekly_partner.parquet
  partitions: 200

# Weekly Aggregated Text Messaging Data and filled missing weeks
l2_text_messaging_scaffold_weekly:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/sms/text_messaging_weekly_final.parquet
  partitions: 150

# Weekly Aggregated Commercial Text Messaging Data and filled missing weeks
l2_commercial_text_messaging_scaffold_weekly:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/sms/commercial_text_messaging_weekly_final.parquet
  partitions: 200

###################################
#########  FEATURE LAYER  #########
###################################

# Text Messaging Features
l4_fea_text_messaging:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/sms/fea_text_messaging.parquet
  partitions: 150

# Commercial Text Messaging Features
l4_fea_commercial_text_messaging:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/sms/fea_commercial_text_messaging.parquet
  partitions: 100

########################################################################################################################
################################################  Voice Calls Features  ################################################
########################################################################################################################

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Voice Calls Data
l2_voice_calling_weekly_aggregated:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/voice_calls/voice_calls_weekly_agg.parquet
  partitions: 500

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs Voice Calls Data
l2_voice_calling_weekly_aggregated_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/voice_calls/voice_calls_partner.parquet
  partitions: 500

# Weekly Aggregated Voice Calls Data and filled missing weeks
l2_voice_calling_time_series_filled:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/voice_calls/voice_calls_time_series_filled.parquet
  partitions: 500

###################################
#########  FEATURE LAYER  #########
###################################

# Voice Calls Features
l4_fea_voice_calling:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/voice_calls/fea_voice_calls.parquet
  partitions: 250

########################################################################################################################
################################################  PayU Usage Features ##################################################
########################################################################################################################

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated PAYU Usage data
l2_payu_usage_weekly_aggregation:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/payu_usage/payu_usage_weekly.parquet
  partitions: 25

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs PAYU Usage data
l2_payu_usage_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/payu_usage/payu_usage_weekly_partner_data.parquet
  partitions: 50

# Weekly Aggregated PAYU Usage and filled missing weeks
l2_payu_usage_scaffold_weekly:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/payu_usage/payu_usage_weekly_time_series_filled.parquet
  partitions: 50

###################################
#########  FEATURE LAYER  #########
###################################

# PAYU Usage Features
l4_fea_payu_usage:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/payu_usage/fea_payu_usage.parquet
  partitions: 75

########################################################################################################################
################################################  Network Features ##################################################
########################################################################################################################

##################################
#######  Source TSEL Data  #######
##################################

l1_mck_sales_dnkm_dd:
  <<: *hive_event_date_1w
  layer: raw
  database: mck
  table: sales_dnkm_dd

l1_network_tutela_weekly:
  <<: *hive_yearweek_1w
  layer: raw
  database: nwa_exr
  table: tutela_border_ww

##################################
#########  STATIC LAYER  #########
##################################

# lacci to msisdn mapping Jan 2019 - Oct 2019
l1_lacci_msisdn_mapping_jan_oct_2019:
  <<: *parquet
  layer: static
  filepath: mck_dmp_common/kedro/02_primary/network_mapping/msisdn_to_lacci_jan_oct_2019.parquet
  partitions: 5

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Network MSISDN data
l1_network_msisdn_weekly_aggregated:
  <<: *parquet_weekstart_6m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/network/network_msisdn_weekly.parquet
  partitions: 500

# Weekly Aggregated Network Lac_ci data
l1_network_lacci_weekly_aggregated:
  <<: *parquet_weekstart_6m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/network/network_lacci_weekly.parquet
  partitions: 5

# Weekly Aggregated Network Lac data
l1_network_lac_weekly_aggregated:
  <<: *parquet_weekstart_6m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/network/network_lac_weekly.parquet
  partitions: 1

l2_network_tutela_location_weekly_aggregated:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_score/01_aggregation/network/network_tutela_weekly.parquet
  partitions: 1

###################################
#########  PRIMARY LAYER  #########
###################################

l2_network_msisdn_weekly_filtered:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/network/network_msisdn_weekly_partner.parquet
  partitions: 1000

l2_network_msisdn_scaffold_weekly:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/network/scaffolding_network_msisdn_weekly.parquet
  partitions: 1000

l2_network_lacci_scaffold_weekly:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/network/scaffolding_network_lacci_weekly.parquet
  partitions: 50

l2_network_lac_scaffold_weekly:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/network/scaffolding_network_lac_weekly.parquet
  partitions: 5

###################################
#########  FEATURE LAYER  #########
###################################

l4_fea_network_msisdn:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/network/fea_network_msisdn.parquet
  partitions: 1000

l4_fea_network_lacci:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/network/fea_network_lacci.parquet
  partitions: 150

l4_fea_network_lac:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/network/fea_network_lac.parquet

l4_fea_network_tutela:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/network/fea_network_tutela.parquet
  partitions: 1

l5_fea_map_msisdn_to_tutela_network:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/network/fea_map_msisdn_to_tutela_network.parquet
  partitions: 80

########################################################################################################################
############################################  Customer Profile Features ################################################
########################################################################################################################

##################################
#######  Source TSEL Data  #######
##################################

l1_cb_multidim:
  <<: *hive
  layer: raw
  database: cb
  table: cb_multidim
  sla_interval:
    period: 1d
    date: 1
    time: "18:00"
    column_reference: "event_date"
    date_format: "%Y-%m-%d"
    start_date: "2019-01-01"

l1_base_nsb:
  <<: *hive_event_date_1w
  layer: raw
  database: base
  table: digipos_nsb

l1_subs_ocs_sse:
  <<: *hive_event_date_1w
  layer: raw
  database: base
  table: subs_ocs_sse

l1_dbi_redeem_poin:
  <<: *hive_event_date_1w
  layer: raw
  database: dbi_dc
  table: all_redeem_poin

l1_digipos_sp_migration:
  <<: *hive_event_date_1w
  layer: raw
  database: base
  table: digipos_sp_migration

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Customer Profile data
l2_customer_profile_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/customer_profile/customer_profile_weekly.parquet
  partitions: 60

l2_customer_profile_sellthru_weekly:
  <<: *parquet_weekstart_6m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/customer_profile/customer_profile_sellthru_weekly.parquet
  partitions: 1

l2_customer_profile_nsb_weekly:
  <<: *parquet_weekstart_6m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/customer_profile/customer_profile_nsb_weekly.parquet
  partitions: 60

l2_customer_profile_points_redeemed_weekly:
  <<: *parquet_weekstart_6m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/customer_profile/customer_profile_points_redeemed_weekly.parquet
  partitions: 2

l2_outlet_weekly:
  <<: *parquet_weekstart_6m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/customer_profile/outlet_weekly.parquet
  partitions: 1

l2_customer_expiry_weekly:
  <<: *parquet_weekstart_1w
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/customer_profile/customer_expiry_weekly.parquet
  partitions: 40

###################################
#########  PRIMARY LAYER  #########
###################################

## Partner MSISDNs Customer Profile Data
l3_customer_profile_partner:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_profile/customer_profile_partner.parquet
  partitions: 40

l3_customer_profile_nsb_partner:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_profile/fea_customer_profile_nsb_partner.parquet
  partitions: 40

l3_customer_expiry_partner:
  <<: *parquet_weekstart_1w
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_profile/customer_expiry_partner.parquet
  partitions: 40

l3_customer_profile_sellthru_partner:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_profile/customer_profile_sellthru_partner.parquet
  partitions: 2

l3_customer_profile_redeemed_points_partner:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_profile/customer_profile_points_reedemed_partner.parquet
  partitions: 2

l4_customer_profile_sellthru_scaffold_weekly:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_profile/customer_profile_sellthru_scaffold_weekly.parquet
  partitions: 2

l4_customer_profile_redeemed_points_scaffold_weekly:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_profile/customer_profile_points_reedemed_scaffold.parquet
  partitions: 2

l4_customer_profile_nsb_scaffold_weekly:
  <<: *parquet_weekstart_6m
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_profile/customer_profile_points_nsb_scaffold.parquet
  partitions: 40

l4_customer_profile_scaffold_weekly:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/customer_profile/customer_profile_scaffold_weekly.parquet
  partitions: 25

###################################
#########  FEATURE LAYER  #########
###################################

l5_fea_customer_profile:
  <<: *parquet_weekstart_6m
  layer: feature
  filepath: mck_dmp_score/04_features/customer_profile/fea_customer_profile.parquet
  partitions: 40

l5_fea_customer_activation_outlet:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/customer_profile/customer_profile_activation_outlet.parquet
  partitions: 2

l5_fea_customer_nsb:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/customer_profile/fea_customer_nsb.parquet
  partitions: 40

l5_fea_customer_points:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/customer_profile/fea_customer_points.parquet
  partitions: 40

l5_fea_customer_expiry:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/customer_profile/fea_customer_expiry.parquet
  partitions: 40

########################################################################################################################
############################################  Product Features ################################################
########################################################################################################################

##################################
#######  Source TSEL Data  #######
##################################

l1_smy_usage_ocs_chg_dd:
  <<: *hive_event_date_1w
  layer: raw
  database: smy
  table: usage_ocs_chg_dd
  sla_interval:
    period: 1d
    date: 1
    time: "02:30"
    start_date: "2019-01-01"

l1_mck_sku_bucket_pivot:
  <<: *hive
  layer: raw
  database: mck
  table: sku_bucket_pivot

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Non-Macro Product Data
l1_nonmacro_product_weekly_data:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/product/nonmacro_product_weekly.parquet
  partitions: 20

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs Non-Macro Product Data
l1_nonmacro_product_weekly_data_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/product/nonmacro_product_weekly_partner.parquet
  partitions: 250

# Weekly Aggregated Non-Macro Product Data and filled missing weeks
l1_nonmacro_product_weekly_data_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/product/nonmacro_product_weekly_final.parquet
  partitions: 250

###################################
#########  FEATURE LAYER  #########
###################################

#  Non-Macro Product Features
l4_fea_nonmacro_product:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/product/fea_nonmacro_product.parquet
  partitions: 250

########################################################################################################################
####################################################  Master Table  ####################################################
########################################################################################################################

# Master Dimension Table
l6_master_dimension:
  <<: *parquet_weekstart_1w
  layer: master
  filepath: mck_dmp_score/05_model_input/master_dimension.parquet
  partitions: 100

# Master Table
l6_master:
  <<: *parquet
  layer: master
  filepath: mck_dmp_score/05_model_input/master.parquet
  partitions: 1500
  create_versions: True
  save_args:
    mode: overwrite
    partitionBy:
      - weekstart
  sla_interval:
    period: weekly
    date_partitioned_column: weekstart
    date_partitioned_column_format: "%Y-%m-%d"
    date: 6

l6_master_metadata:
  <<: *parquet
  layer: score
  filepath: mck_dmp_score/05_model_input/master_metadata.parquet
  partitions: 1
  save_args:
    mode: overwrite
    partitionBy: created_at

# Old master_old
l6_master_old:
  <<: *parquet
  layer: master
  filepath: mck_dmp_score/05_model_input/master.parquet
  partitions: 1500
  create_versions: True
  save_args:
    mode: overwrite
    partitionBy:
      - weekstart
  load_args:
    partition_filter_period: 1w
    partition_column: weekstart
    partition_date_format: "%Y-%m-%d"
    version_index: 1

# Master External Hive Table
l6_master_hive:
  <<: *hive
  layer: raw
  database: dmp_production
  table: master_dmp

########################################################################################################################
##################################################    MyTSel Domain   ##################################################
########################################################################################################################

##################################
#######  Source TSEL Data  #######
##################################

l1_mck_mytsel_daily_user:
  <<: *hive
  layer: raw
  database: mck
  table: dd_mytsel_daily_user
  load_args:
    partition_filter_period: 1w
    partition_column: trx_date
    partition_date_format: "%Y-%m-%d"
  sla_interval:
    period: 1d
    date: 2
    time: "09:00"
    start_date: "2020-01-01"

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Non-Macro Product Data --master_master
l2_mytsel_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/mytsel/mytsel_weekly.parquet
  partitions: 1

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs MyTSel Data
l3_mytsel_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/mytsel/mytsel_weekly_filtered.parquet
  partitions: 10 # TODO: Update Partition

# Partner MSISDNs MyTSel Data and filled missing weeks
l3_mytsel_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/mytsel/mytsel_weekly_final.parquet
  partitions: 10 # TODO: Update Partition

###################################
#########  FEATURE LAYER  #########
###################################

#  MyTSel Features
l4_fea_mytsel:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/mytsel/fea_mytsel.parquet
  partitions: 10 # TODO: Update Partition

########################################################################################################################
################################################  Airtime Loan Features  ################################################
########################################################################################################################

##################################
#######  Source TSEL Data  #######
##################################

l1_cms_data:
  <<: *hive_event_date_1w
  layer: raw
  database: base
  table: cms_tracking_stream

###################################
#######  AGGREGATION LAYER  #######
###################################

# Weekly Aggregated Airtime Loan Data
l2_airtime_loan_weekly:
  <<: *parquet_weekstart_3m
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/airtime/airtime_loan_weekly.parquet
  partitions: 50

###################################
#########  PRIMARY LAYER  #########
###################################

# Partner MSISDNs Airtime Loan Data
l3_airtime_loan_weekly_filtered:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/airtime/airtime_loan_weekly_partner.parquet
  partitions: 50

# Weekly Aggregated Airtime Loan Data and filled missing weeks
l4_airtime_loan_weekly_final:
  <<: *parquet_weekstart_3m
  layer: primary
  filepath: mck_dmp_score/02_primary/airtime/airtime_loan_weekly_final.parquet
  partitions: 50

###################################
#########  FEATURE LAYER  #########
###################################

# Airtime Loan Features
l5_fea_airtime_loan:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/airtime/fea_airtime_loan.parquet
  partitions: 50

l5_fea_airtime_loan_offer_n_revenue:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_training/04_features/airtime/fea_airtime_loan_offer_n_revenue.parquet
  partitions: 50

l5_airtime_loan_target_variable:
  <<: *parquet_weekstart_1w
  layer: feature
  filepath: mck_dmp_score/04_features/airtime/airtime_loan_target_variable.parquet
  partitions: 50

########################################################################################################################
##################################################  Outlets (Reseller) #################################################
########################################################################################################################

##################################
#########  STATIC LAYER  #########
##################################

l1_big_poi:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_poi_big.parquet

l1_ext_HDX_coast_points:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_hdx_coast_points.parquet

l1_ext_OSM_primary_roads:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_osm_primary_roads.parquet

l1_ext_OSM_primary_and_secondary_roads:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_osm_primary_and_secondary_roads.parquet

l1_ext_OSM_railways:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_osm_railways.parquet

l1_ext_ACLED_conflict_events:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_acled_conflict_events_20200713.parquet

l1_ext_OSM_POIs:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_osm_pois.parquet

l1_fb_pop:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_pop_fb.parquet

l1_ext_WP_demographics:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_wp_demographics_20200714.parquet

l1_fb_share:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_fb_share.parquet

l1_4g_bts_share:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_4g_bts_share.parquet

l1_archetype:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_city_archetypes_2020.parquet

l1_ext_opensignal:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_opensignal.parquet

l1_digistar_sellthru_det:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/dmp_remote_digistar_sellthru_det.parquet

l1_ext_GHS_urbanicity:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_ghs_urbanicity_20200713.parquet

l1_ext_GAR_demographics:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_gar_demographics.parquet

l1_ext_WP_elevation:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_wp_elevation.parquet

l1_ext_NEO_rainfall_index:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_neo_rainfall_index.parquet

l1_ext_ocid_cell_towers:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_ocid_cell_towers_20200713.parquet

l1_ext_Dryad_HDI:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_dryad_hdi_20200714.parquet

l1_ext_Dryad_GDP_per_capita:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_dryad_gdp_per_capita_20200714.parquet

l1_ext_Dryad_GDP:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_dryad_gdp_20200714.parquet

l1_ext_HDX_administrative_divisions:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_hdx_administrative_divisions_20200714.parquet

l1_ext_BPS_extreme_poverty_percentages:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_bps_extreme_poverty_percentages.parquet

l1_zone_pricing:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_zone_pricing.parquet

l1_ext_bps_susenas:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_bps_susenas.parquet

l1_ext_bps_podes:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_bps_podes.parquet

l1_ext_bps_sakernas:
  <<: *parquet
  layer: static
  filepath: mck_dmp_score/00_reference/outlet/external_data/mck_ext_bps_sakernas.parquet

##################################
#######  Source TSEL Data  #######
##################################

l1_outlet_dim_dd:
  <<: *hive_trx_date_1cm
  layer: raw
  database: sch
  table: outlet_dim_dd
  sla_interval:
    period: 1d
    date: 1
    time: "09:00"
    column_reference: "trx_date"
    date_format: "%Y-%m-%d"
    start_date: "2019-01-01"

l1_digipos_outlet_reference_dd:
  <<: *hive
  layer: raw
  database: sch
  table: digipos_outlet_reference_dd
  load_args:
    partition_filter_period: 1w
    partition_column: event_date
    partition_date_format: "%Y-%m-%d"
  sla_interval:
    period: 1d
    date: 1
    time: "04:00"
    column_reference: "event_date"
    date_format: "%Y-%m-%d"
    start_date: "2019-01-01"

l1_rech_mkios_dd:
  <<: *hive
  layer: raw
  database: smy
  table: rech_mkios_dd
  sla_interval:
    period: 1d
    date: 1
    time: "02:30"
    column_reference: "event_date"
    date_format: "%Y-%m-%d"
    start_date: "2019-01-01"

l1_rech_urp_dd:
  <<: *hive
  layer: raw
  database: smy
  table: rech_urp_dd
  sla_interval:
    period: 1d
    date: 1
    time: "02:30"
    column_reference: "event_date"
    date_format: "%Y-%m-%d"
    start_date: "2019-01-01"

l1_claudia_enable:
  <<: *hive
  layer: raw
  database: base
  table: claudia_enable

l1_claudia_daily_used:
  <<: *hive_event_date_1cm
  layer: raw
  database: base
  table: claudia_daily_used

l1_dnkm:
  <<: *hive
  layer: raw
  database: mck
  table: sales_dnkm_dd

l1_salesforce:
  <<: *hive
  layer: raw
  database: sch
  table: digipos_sf_journey_dd

l1_dealer:
  <<: *hive
  layer: raw
  database: sch
  table: outlet_dealer_reff

l1_ext_ookla:
  <<: *hive
  layer: raw
  database: nwa
  table: nwa_exr_ookla

###################################
#######  AGGREGATION LAYER  #######
###################################

############ 1. Common  ###########

l1_mkios_cleaned:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/mkios_cleaned.parquet
  save_args:
    mode: overwrite
    partitionBy: event_date

l1_urp_cleaned:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/urp_cleaned.parquet
  save_args:
    mode: overwrite
    partitionBy: event_date

#### 2. Geospatial Aggregation ####

l1_dnkm_paritioned_by_trx_date:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/dnkm_paritioned_by_trx_date.parquet

l1_unique_outlets:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/unique_outlets.parquet
  partitions: 25

l1_outlets_with_most_recent_classf:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/outlets_with_most_recent_classf.parquet
  partitions: 25

l1_unique_big_pois:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/unique_big_pois.parquet
  partitions: 25

l1_unique_ext_HDX_coast_points:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/unique_ext_HDX_coast_points.parquet
  partitions: 25

l1_unique_ext_OSM_primary_roads:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/unique_ext_OSM_primary_roads.parquet
  partitions: 25

l1_unique_ext_OSM_primary_and_secondary_roads:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/unique_ext_OSM_primary_and_secondary_roads.parquet
  partitions: 25

l1_unique_ext_OSM_railways:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/unique_ext_OSM_railways.parquet
  partitions: 25

l1_unique_ext_OSM_POIs:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/unique_ext_OSM_POIs.parquet
  partitions: 25

l1_outlets_with_neighbours:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/outlets_with_neighbours.parquet
  partitions: 25

l1_big_pois_with_neighbours:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/big_pois_with_neighbours.parquet
  partitions: 25

l1_osm_pois_with_neighbours:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/osm_pois_with_neighbours.parquet
  partitions: 25

l1_conflict_pois_with_neighbours:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/conflict_pois_with_neighbours.parquet
  partitions: 25

l1_dfj_big_poi_outlet:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/dfj_big_poi_outlet.parquet
  partitions: 1000

l1_dfj_osm_poi_outlet:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/dfj_osm_poi_outlet.parquet
  partitions: 1000

l1_dfj_conflict_poi_outlet:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/dfj_conflict_poi_outlet.parquet
  partitions: 1000

l1_dfj_outlets_near_outlet:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/dfj_outlets_near_outlet.parquet
  partitions: 1000

l1_mkios_neighb_uniq:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/mkios_neighb_uniq.parquet

l1_urp_neighb_uniq:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/urp_neighb_uniq.parquet

l1_fb_points_with_neighbours:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/fb_points_with_neighbours.parquet
  partitions: 500

l1_dfj_outlet_fb_pop:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/dfj_outlet_fb_pop.parquet
  partitions: 5000

### 3. Revenue Aggregation ###

l1_mkios_cleaned_rev:
  <<: *parquet_event_date_1cm
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/mkios_cleaned.parquet

l1_urp_cleaned_rev:
  <<: *parquet_event_date_1cm
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/urp_cleaned.parquet

l1_outlet_digipos_daily_aggregated:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/outlet_digipos_daily_agg.parquet
  partitions: 7

l1_outlet_id_msisdn_mapping:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/outlet_id_msisdn_mapping.parquet
  partitions: 1

l1_dfj_digipos_mkios:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/dfj_mkios_outlet_id_to_rs_msisdn.parquet

l1_mkios_recharge_daily_aggregated:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/mkios_recharge_daily_agg.parquet
  partitions: 7

l1_mkios_recharge_daily_mode_aggregated:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/mkios_recharge_daily_mode_agg.parquet
  partitions: 7

l1_modern_daily_aggregated:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/modern_daily_agg.parquet
  partitions: 7

l1_dnkm_agg_by_lacci:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/dnkm_agg_by_lacci.parquet
  partitions: 7

l1_total_modern_channel_recharges:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/total_modern_channel_recharges.parquet
  partitions: 7

l1_pv_inj_lacci_outlet_stats:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/pv_inj_lacci_outlet_stats.parquet
  partitions: 7

l1_pv_inj_city_stats:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/pv_inj_city_stats.parquet
  partitions: 7

l1_pv_inj_rs_msisdn_outlet_stats:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/pv_inj_rs_msisdn_outlet_stats.parquet
  partitions: 7

l1_pv_red_lacci_outlet_stats:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/pv_red_lacci_outlet_stats.parquet
  partitions: 7

l1_pv_red_city_stats:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/pv_red_city_stats.parquet
  partitions: 7

l1_pv_red_rs_msisdn_outlet_stats:
  <<: *parquet_trx_date_1cm_format_2
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/pv_red_rs_msisdn_outlet_stats.parquet
  partitions: 7

l1_all_filters:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/all_filters.parquet
  partitions: 5

###################################
#########  FEATURE LAYER  #########
###################################

#### 1. Geospatial Features ####

l2_outlet_geospatial_pick_nearest_and_assign:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_geospatial_pick_nearest_and_assign.parquet

l2_closest_big_pois_to_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_closest_big_pois_to_outlet.parquet

l2_closest_osm_pois_to_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_closest_osm_pois_to_outlet.parquet

l2_total_big_pois_count_for_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_total_big_pois_count_for_outlet.parquet

l2_total_conflict_count_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_total_conflict_count_outlet.parquet

l2_outlet_to_outlet_min_dist:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_to_outlet_min_dist.parquet

l2_outlet_counts_per_outlet_in_radius:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_counts_per_outlet_in_radius.parquet

l2_fb_pop_for_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_fb_pop_for_outlet.parquet
  partitions: 5000

l2_fb_share_for_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_fb_share_for_outlet.parquet

l2_4g_bts_share_for_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_4g_bts_share_for_outlet.parquet

l2_outlet_archetype:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_archetype.parquet

l2_outlet_dealer:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_dealer.parquet

l2_outlet_ookla:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_ookla.parquet

l2_outlet_opensignal:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_opensignal.parquet

l2_outlet_digistar_sellthru_det:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_digistar_sellthru_det.parquet

l2_outlet_salesforce:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_salesforce.parquet

l2_types_of_outlets_near_an_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_types_of_outlets_near_an_outlet.parquet

l2_outlets_in_radiuses_based_on_classf:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlets_in_radiuses_based_on_classf.parquet

l2_outlets_cashflow_in_radiuses_based_on_classf:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlets_cashflow_in_radiuses_based_on_classf.parquet

l2_min_dist_to_lacci_from_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_min_dist_to_lacci_from_outlet.parquet

l2_mkios_channel_rech:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_mkios_channel_rech.parquet

l2_urp_channel_rech:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_urp_channel_rech.parquet

l2_outlet_geospatial_nearest_poi_dist_from_outlet:
  <<: *parquet
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_outlet_geospatial_nearest_poi_dist_from_outlet.parquet

l3_outlet_master_static:
  <<: *parquet
  layer: master
  filepath: mck_dmp_score/05_model_input/outlets/master_outlet_geo.parquet
  save_args:
    mode: append
    partitionBy: month
  create_versions: True
  sla_interval:
    period: monthly
    date_partitioned_column: month
    date_partitioned_column_format: "%Y-%m-%d"
    date: 11

l3_outlet_master_static_old:
  <<: *parquet
  layer: master
  filepath: mck_dmp_score/05_model_input/outlets/master_outlet_geo.parquet
  save_args:
    mode: append
    partitionBy: month
  create_versions: True
  load_args:
    version_index: 1

l3_outlet_geospatial_master_static_hive:
  <<: *hive
  layer: raw
  database: dmp_production
  table: master_outlet_geo

#### 2. Revenue Features ####

l2_fea_hsupa:
  <<: *parquet_trx_date_1cm_format_2
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_hsupa.parquet

l2_fea_3g_and_payload:
  <<: *parquet_trx_date_1cm_format_2
  layer: feature
  filepath: mck_dmp_score/04_features/outlets/fea_3g_and_payload.parquet

l3_outlet_master_revenue_daily:
  <<: *parquet
  layer: master
  filepath: mck_dmp_score/05_model_input/outlets/master_outlet_revenue_daily_scoring.parquet
  create_versions: True
  partitions: 1
  save_args:
    mode: append
    partitionBy:
      - month
      - trx_date
  sla_interval:
    period: monthly
    date_partitioned_column: month
    date_partitioned_column_format: "%Y-%m-%d"
    date: 11

l3_outlet_master_revenue_daily_old:
  <<: *parquet
  layer: master
  filepath: mck_dmp_score/05_model_input/outlets/master_outlet_revenue_daily_scoring.parquet
  create_versions: True
  partitions: 1
  save_args:
    mode: append
    partitionBy:
      - month
      - trx_date
  load_args:
    version_index: 1

l3_outlet_master_revenue_daily_tsf:
  <<: *parquet
  layer: master
  filepath: mck_dmp_score/05_model_input/outlets/master_outlet_revenue_daily_scoring_tsf.parquet
  create_versions: True
  partitions: 10
  save_args:
    mode: append
    partitionBy:
      - month
      - trx_date

l3_outlet_revenue_master_hive:
  <<: *hive
  layer: raw
  database: dmp_production
  table: master_outlet_rev

###################################
###########  QA LAYER  ############
###################################

qa_outlet_dim_dd:
  <<: *hive
  layer: raw
  database: sch
  table: outlet_dim_dd

qa_join_accuracies_results:
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  layer: raw
  database: dmp_production
  table: qa_join_accuracies
  write_mode: upsert
  table_pk:
    - left_table
    - right_table
    - run_date_time

qa_time_series_continuity_results:
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  layer: raw
  database: dmp_production
  table: qa_time_series_continuity
  write_mode: upsert
  table_pk:
    - outlet_id
    - run_date_time

qa_de_reseller_outlet_filtering:
  type: src.dmp.io.spark_hive_dataset.SparkHiveDataSet
  layer: raw
  database: dmp_production
  table: reseller_de_filtered_outlets
  write_mode: upsert
  table_pk:
    - outlet_id
    - start_date
    - end_date
    - run_date_time

l1_additional_outlet_counts:
  <<: *parquet
  layer: aggregation
  filepath: mck_dmp_pipeline/01_aggregation/outlets/additional_outlet_counts.parquet
  save_args:
    mode: append

########################################################################################################################
###############################################    Data Quality   ######################################################
########################################################################################################################

###########################################    QA Availability   ################################################

l1_qa_availability_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_availability

l1_qa_availability_score_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

###############################################    MSISDN SAMPLE   #####################################################

l4_qa_sample_unique_msisdn:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/sample/sample_unique_msisdn.parquet

###############################################    OUTLET QA TABLE   #####################################################

l4_qa_master_outlet_geo_metrics:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/master/master_outlet_geo/metrics.parquet

l4_qa_master_outlet_geo_outliers:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/master/master_outlet_geo/outliers.parquet

l4_qa_master_outlet_revenue_metrics:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/master/master_outlet_revenue/metrics.parquet

l4_qa_master_outlet_revenue_outliers:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/master/master_outlet_revenue/outliers.parquet

###########################################    OUTLET QA TABLE UNION   ##################################################

l4_qa_master_outlet_metrics:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/master/outlet/metrics.parquet

l4_qa_master_outlet_outliers:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/master/outlet/outliers.parquet

################################################    OUTLET QA DB   #######################################################

l4_qa_outlet_master_metrics_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_metrics

l4_qa_outlet_master_outliers_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_outliers

#########################################    QA Result DB - Aggregation   ###############################################

l4_qa_aggregation_metrics_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_metrics

l4_qa_aggregation_monthly_unique_msisdn_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_monthly_unique_msisdn

l4_qa_aggregation_outliers_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_outliers

###########################################    QA Result DB - Feature   #################################################

l4_qa_feature_metrics_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_metrics

l4_qa_feature_monthly_unique_msisdn_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_monthly_unique_msisdn

l4_qa_feature_outliers_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_outliers

############################################    QA Result DB - Master   ##################################################

l4_qa_master_metrics_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_metrics

l4_qa_master_monthly_unique_msisdn_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_monthly_unique_msisdn

l4_qa_master_outliers_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_outliers

############################################    QA Result DB   ##################################################

l4_qa_metrics_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_metrics

#######################################    QA Thresolding  - Aggregation - Parquet   ############################################

l4_qa_score_aggregation_accuracy_completeness:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/aggregation/accuracy_completeness.parquet

l4_qa_score_aggregation_accuracy_completeness_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/aggregation/accuracy_completeness_aggregate.parquet

l4_qa_score_aggregation_consistency:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/aggregation/consistency.parquet

l4_qa_score_aggregation_consistency_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/aggregation/consistency_aggregate.parquet

#######################################    QA Thresolding  - Feature - Parquet   ############################################

l4_qa_score_feature_accuracy_completeness:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/feature/accuracy_completeness.parquet

l4_qa_score_feature_accuracy_completeness_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/feature/accuracy_completeness_aggregate.parquet

l4_qa_score_feature_consistency:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/feature/consistency.parquet

l4_qa_score_feature_consistency_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/feature/consistency_aggregate.parquet

#######################################    QA Thresolding  - Master - Parquet   ############################################

l4_qa_score_master_master_accuracy_completeness:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/master/accuracy_completeness.parquet

l4_qa_score_master_master_accuracy_completeness_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/master/accuracy_completeness_aggregate.parquet

l4_qa_score_master_master_consistency:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master_master/consistency.parquet

l4_qa_score_master_master_consistency_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master_master/consistency_aggregate.parquet

#######################################    QA Thresolding  - Master Outlet Geo - Parquet   ############################################

l4_qa_score_master_outlet_geo_accuracy_completeness:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/outlet_geo/accuracy_completeness.parquet

l4_qa_score_master_outlet_geo_accuracy_completeness_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/outlet_geo/accuracy_completeness_aggregate.parquet

l4_qa_score_master_outlet_geo_consistency:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/outlet_geo/consistency.parquet

l4_qa_score_master_outlet_geo_consistency_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/outlet_geo/consistency_aggregate.parquet

#######################################    QA Thresolding  - Master Outlet Revenue - Parquet   ############################################

l4_qa_score_master_outlet_revenue_accuracy_completeness:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/outlet_revenue/accuracy_completeness.parquet

l4_qa_score_master_outlet_revenue_accuracy_completeness_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/outlet_revenue/accuracy_completeness_aggregate.parquet

l4_qa_score_master_outlet_revenue_consistency:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/outlet_revenue/consistency.parquet

l4_qa_score_master_outlet_revenue_consistency_aggregate:
  <<: *parquet
  layer: data_quality
  filepath: mck_dmp_score/06_qa_check/threshold/master/outlet_revenue/consistency_aggregate.parquet

###########################################    QA Thresolding - Aggregation - Database   ################################################

l4_qa_score_aggregation_accuracy_completeness_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_aggregation_accuracy_completeness_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

l4_qa_score_aggregation_consistency_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_aggregation_consistency_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

###########################################    QA Thresolding - Feature - Database   ################################################

l4_qa_score_feature_accuracy_completeness_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_feature_accuracy_completeness_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

l4_qa_score_feature_consistency_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_feature_consistency_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

###########################################    QA Thresolding - Master - Database   ################################################

l4_qa_score_master_master_accuracy_completeness_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_master_master_accuracy_completeness_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

l4_qa_score_master_master_consistency_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_master_master_consistency_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

###########################################    QA Thresolding - Master Outlet Geo - Database   ################################################

l4_qa_score_master_outlet_geo_accuracy_completeness_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_master_outlet_geo_accuracy_completeness_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

l4_qa_score_master_outlet_geo_consistency_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_master_outlet_geo_consistency_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

###########################################    QA Thresolding - Master Outlet Revenue - Database   ################################################

l4_qa_score_master_outlet_revenue_accuracy_completeness_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_master_outlet_revenue_accuracy_completeness_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

l4_qa_score_master_outlet_revenue_consistency_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold

l4_qa_score_master_outlet_revenue_consistency_aggregate_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

#####################################################    QA Timeliness   ##########################################################
l7_qa_timeliness_master_metrics_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_timeliness

l7_qa_timeliness_master_score_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

l7_qa_timeliness_outlet_geo_metrics_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_timeliness

l7_qa_timeliness_outlet_geo_score_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg

l7_qa_timeliness_outlet_revenue_metrics_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_timeliness

l7_qa_timeliness_outlet_revenue_score_db:
  <<: *jdbc_oracle_qa_db
  table: prod_qa_threshold_agg
